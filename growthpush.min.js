/**
 * Modules in this bundle
 * 
 * eventemitter3:
 *   license: MIT
 *   author: Arnout Kazemier
 *   maintainers: v1 <npm@3rd-Eden.com>, 3rdeden <npm@3rd-Eden.com>, lpinca <luigipinca@gmail.com>
 *   version: 1.1.1
 * 
 * growthpush-javascript:
 *   version: 1.1.4
 * 
 * nanoajax:
 *   license: MIT
 *   author: Jon Eisen <jon@joneisen.me>
 *   maintainers: yanatan16 <jon.m.eisen@gmail.com>
 *   version: 0.3.1
 * 
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.GrowthPush=e()}}(function(){return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return i(n?n:e)},d,d.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){var r=e("nanoajax"),i=function(){function e(e,t){void 0===t&&(t=0),this.baseUrl=e,this.timeout=t}return e.prototype.get=function(e,t,n,r){return this._request("GET",e,t,n,r)},e.prototype.post=function(e,t,n,r){return this._request("POST",e,t,n,r)},e.prototype.put=function(e,t,n,r){return this._request("PUT",e,t,n,r)},e.prototype["delete"]=function(e,t,n,r){return this._request("DELETE",e,t,n,r)},e.prototype._request=function(e,t,n,r,i){"jsonp"===n.dataType?this._requestByJsonp("GET",t,n,r,i):this._requestByXhr(e,t,n,r,i)},e.prototype._requestByJsonp=function(e,t,n,r,i){var o=this._makeParamsArray(n.params),s="growthbeat"+Math.random().toString(36).slice(-8);o=o.concat("callback="+s);var a=this.baseUrl+t+"?"+o.join("&"),u=document.createElement("script");u.async=!0,u.src=a,window[s]=function(e){delete window[s],document.body.removeChild(u),r(e,200)},u.onerror=function(e){i()},document.body.appendChild(u)},e.prototype._requestByXhr=function(e,t,n,i,o){var s=this._makeParamsArray(n.params),a={method:e,url:this.baseUrl+t,withCredentials:n.withCredentials};"GET"===e?a.url=a.url+"?"+s.join("&"):a.body=s.join("&"),r.ajax(a,function(e,t){if(200===e){var n=JSON.parse(t);i(n,e)}else{var r={};o(r,e)}})},e.prototype._makeParamsArray=function(e){var t=null==e?{}:e,n=Object.keys(t).map(function(e){var n="";return n="object"==typeof t[e]?JSON.stringify(t[e]):t[e],encodeURIComponent(e)+"="+encodeURIComponent(n)});return n},e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i},{nanoajax:9}],2:[function(e,t,n){function r(e){if(!b){if(b=!0,null==e.environment&&(e.environment="development"),"development"!==e.environment&&"production"!==e.environment)throw new Error("GrowthPush: unsupported environment: "+e.environment);null==e.isDetailEvent&&(e.isDetailEvent=!1),I=e,x.start()}}function i(){b&&q()&&"serviceWorker"in navigator&&"Notification"in window&&"indexedDB"in window&&navigator.serviceWorker.register(I.receiver).then(j).then(P).then(N).then(S).then(function(e){_=!0,y.emit("registered")})["catch"](function(e){"denied"===Notification.permission&&x.stop(),y.emit("error")})}function o(e,t){if("Notification"in window&&"indexedDB"in window&&"denied"!==Notification.permission&&null!=e){var n=JSON.parse(p["default"].get("growthpush.tag:"+e));(!n||n.value!==t&&(null!=n.value||""!==t&&null!=t))&&T(function(n){var r={clientId:n.getId(),code:n.getCode(),name:e};null!=t&&""!==t&&(r.value=t),g.post("1/tags",{params:r},function(t,n){p["default"].set("growthpush.tag:"+e,JSON.stringify(t))},function(e,t){})})}}function s(e,t){"Notification"in window&&"indexedDB"in window&&"denied"!==Notification.permission&&null!=e&&T(function(n){var r={clientId:n.getId(),code:n.getCode(),name:e};null!=t&&""!==t&&(r.value=t),g.post("1/events",{params:r},function(e,t){},function(e,t){})})}function a(){if(!("serviceWorker"in navigator))return!1;if(!("Notification"in window))return!1;if("indexedDB"in window)return"granted"!==Notification.permission?!1:!0}function u(e,t){y.on(e,t)}function c(e,t){y.once(e,t)}function d(e,t){y.off(e,t)}function f(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];y.emit(e,t)}var l=e("../utils/indexeddb-wrapper"),p=e("../utils/local-storage-wrapper"),h=e("./model/client"),v=e("./http/http-client"),m=e("../utils/timer"),w=e("eventemitter3"),g=new v["default"]("https://api.growthpush.com/"),y=new w,b=!1,_=!1,I=null,E=null,x=new m["default"](300),j=function(){return"showNotification"in ServiceWorkerRegistration.prototype?"denied"===Notification.permission?Promise.reject(new Error("The user has blocked notifications.")):"PushManager"in window?navigator.serviceWorker.ready.then(function(e){var t=function(n){e.removeEventListener("updatefound",t),i()};return e.addEventListener("updatefound",t),Promise.resolve(e)}):Promise.reject(new Error("Push messaging isn't supported.")):Promise.reject(new Error("Notifications aren't supported."))},P=function(e){return e.pushManager.getSubscription().then(function(t){return t?Promise.resolve(t):k(e)})["catch"](function(e){return Promise.reject(new Error("Error during getSubscription()"))})},k=function(e){return e.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){return Promise.resolve(e)})["catch"](function(e){return Promise.reject("denied"===Notification.permission?new Error("Permission for Notifications was denied"):new Error("Unable to subscribe to push."))})},N=function(e){var t=h["default"].load();return null!=t&&t.getApplicationId()===I.applicationId?t.getToken()===D(e)&&t.getEnvironment()===I.environment?(E=t,Promise.resolve({client:t,subscription:e})):C(t,e):O(e)},O=function(e){return new Promise(function(t,n){var r=h["default"].create({applicationId:I.applicationId,credentialId:I.credentialId,environment:I.environment,token:D(e)});r.on("created",function(){E=r,h["default"].save(r),t({client:r,subscription:e})}),r.on("error",function(){n(new Error("Error during creating client"))})})},C=function(e,t){return new Promise(function(n,r){var i=h["default"].update(e,{code:e.getCode(),token:D(t),environment:I.environment});i.on("updated",function(){E=i,h["default"].save(i),n({client:i,subscription:t})}),i.on("error",function(){r(new Error("Error during updating client"))})})},S=function(e){var t=new l["default"]("growthpush",1,[{name:"kvs"}]);return t.open().then(function(){return t.put("kvs","config",{applicationId:I.applicationId,credentialId:I.credentialId,title:I.appName,icon:I.icon,clickEventName:I.clickEventName,isDetailEvent:I.isDetailEvent,clientId:e.client.getId(),code:e.client.getCode()})})["catch"](function(e){return Promise.reject(new Error("DB configure failed"))})},D=function(e){return null==e.subscriptionId?e.endpoint.split("/").pop():e.subscriptionId};n.init=r,n.register=i;var q=function(){var e=window.navigator.userAgent.toLowerCase();return-1!==e.indexOf("android")},T=function(e){x.add(function(){return E?(e(E),!1):!0})};n.tag=o,n.track=s,n.permitted=a,n.on=u,n.once=c,n.off=d,n.emit=f},{"../utils/indexeddb-wrapper":5,"../utils/local-storage-wrapper":6,"../utils/timer":7,"./http/http-client":1,"./model/client":3,eventemitter3:8}],3:[function(e,t,n){var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../utils/local-storage-wrapper"),o=e("../http/http-client"),s=e("eventemitter3"),a=new o["default"]("https://api.growthpush.com/"),u=function(e){function t(t){e.call(this),null!=t&&this.setData(t)}return r(t,e),t.prototype.setData=function(e){this.id=e.id,this.growthbeatClientId=e.growthbeatClientId,this.token=e.token,this.applicationId=e.applicationId,this.growthbeatApplicationId=e.growthbeatApplicationId,this.code=e.code,this.os=e.os,this.environment=e.environment,this.created=e.created},t.load=function(){var e=i["default"].get("growthpush.client");return null==e?null:new t(JSON.parse(e))},t.save=function(e){if(e){var t={id:e.id,growthbeatClientId:e.growthbeatClientId,token:e.token,applicationId:e.applicationId,growthbeatApplicationId:e.growthbeatApplicationId,code:e.code,os:e.os,environment:e.environment,created:e.created};i["default"].set("growthpush.client",JSON.stringify(t))}},t.create=function(e){var n={params:{applicationId:e.applicationId,secret:e.credentialId,token:e.token,environment:e.environment,os:"android"}},r=new t;return a.post("1/clients",n,function(e,t){r.setData(e),r.emit("created")},function(e,t){r.emit("error")}),r},t.update=function(e,n){var r={params:{token:n.token,environment:n.environment,code:n.code}},i=new t;return a.put("1/clients/"+e.id,r,function(e,t){i.setData(e),i.emit("updated")},function(e,t){i.emit("error")}),i},t.prototype.getId=function(){return this.id},t.prototype.getApplicationId=function(){return this.applicationId},t.prototype.getToken=function(){return this.token},t.prototype.getEnvironment=function(){return this.environment},t.prototype.getCode=function(){return this.code},t}(s);Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=u},{"../../utils/local-storage-wrapper":6,"../http/http-client":1,eventemitter3:8}],4:[function(e,t,n){var r=e("./growthpush/index");t.exports=r},{"./growthpush/index":2}],5:[function(e,t,n){var r=function(){function e(e,t,n){this.db=null,this.dbName=e,this.dbVersion=t,this.stores=n}return e.prototype.open=function(){var e=this;return new Promise(function(t,n){if(null!=e.db)return t();var r=indexedDB.open(e.dbName,e.dbVersion);r.onupgradeneeded=function(t){var n=t.target.result;e.stores.forEach(function(e){n.objectStoreNames.contains(e.name)&&n.deleteObjectStore(e.name),n.createObjectStore(e.name,{autoIncrement:!1})})},r.onsuccess=function(n){e.db=n.target.result,t()},r.onerror=function(e){n("Could not open DB")}})},e.prototype.put=function(e,t,n){if(null==this.db)return Promise.reject(new Error("DB: "+this.dbName+" is not open"));var r=this.db.transaction([e],"readwrite"),i=r.objectStore(e);return new Promise(function(e,r){var o=i.put(n,t);o.onsuccess=function(t){e()},o.onerror=function(e){r("Could not put item")}})},e.prototype.get=function(e,t){if(null==this.db)return Promise.reject(new Error("DB: "+this.dbName+" is not open"));var n=this.db.transaction([e],"readwrite"),r=n.objectStore(e);return new Promise(function(e,n){var i=r.get(t);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onerror=function(e){n("Could not get item")}})},e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],6:[function(e,t,n){function r(e){return window.localStorage?localStorage.getItem(e):null}function i(e,t){if(window.localStorage)try{localStorage.setItem(e,t)}catch(n){}}n.get=r,n.set=i,Object.defineProperty(n,"__esModule",{value:!0}),n["default"]={get:r,set:i}},{}],7:[function(e,t,n){var r=function(){function e(e){this.delay=1e3,this.timerId=0,this.timers=[],this.delay=e}return e.prototype.add=function(e){return this.timers.push(e),this},e.prototype.start=function(){if(!this.timerId){var e=this;!function t(){if(e.timers.length>0){var n;for(n=0;n<e.timers.length;n++)e.timers[n]()===!1&&(e.timers.splice(n,1),n--)}e.timerId=setTimeout(t,e.delay)}()}},e.prototype.stop=function(){clearTimeout(this.timerId),this.timerId=0},e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],8:[function(e,t,n){"use strict";function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){}var o="function"!=typeof Object.create?"~":!1;i.prototype._events=void 0,i.prototype.listeners=function(e,t){var n=o?o+e:e,r=this._events&&this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=new Array(s);s>i;i++)a[i]=r[i].fn;return a},i.prototype.emit=function(e,t,n,r,i,s){var a=o?o+e:e;if(!this._events||!this._events[a])return!1;var u,c,d=this._events[a],f=arguments.length;if("function"==typeof d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),f){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,r),!0;case 5:return d.fn.call(d.context,t,n,r,i),!0;case 6:return d.fn.call(d.context,t,n,r,i,s),!0}for(c=1,u=new Array(f-1);f>c;c++)u[c-1]=arguments[c];d.fn.apply(d.context,u)}else{var l,p=d.length;for(c=0;p>c;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),f){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,n);break;default:if(!u)for(l=1,u=new Array(f-1);f>l;l++)u[l-1]=arguments[l];d[c].fn.apply(d[c].context,u)}}return!0},i.prototype.on=function(e,t,n){var i=new r(t,n||this),s=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.once=function(e,t,n){var i=new r(t,n||this,!0),s=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.removeListener=function(e,t,n,r){var i=o?o+e:e;if(!this._events||!this._events[i])return this;var s=this._events[i],a=[];if(t)if(s.fn)(s.fn!==t||r&&!s.once||n&&s.context!==n)&&a.push(s);else for(var u=0,c=s.length;c>u;u++)(s[u].fn!==t||r&&!s[u].once||n&&s[u].context!==n)&&a.push(s[u]);return a.length?this._events[i]=1===a.length?a[0]:a:delete this._events[i],this},i.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[o?o+e:e]:this._events=o?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=o,"undefined"!=typeof t&&(t.exports=i)},{}],9:[function(e,t,n){(function(e){function t(){if(e.XMLHttpRequest)return new e.XMLHttpRequest;try{return new e.ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){}throw new Error("no xmlhttp request able to be created")}function r(e,t,n){e[t]=e[t]||n}n.ajax=function(e,n){"string"==typeof e&&(e={url:e});var i=e.headers||{},o=e.body,s=e.method||(o?"POST":"GET"),a=e.withCredentials||!1,u=t();u.onreadystatechange=function(){4==u.readyState&&n(u.status,u.responseText,u)},o&&(r(i,"X-Requested-With","XMLHttpRequest"),r(i,"Content-Type","application/x-www-form-urlencoded")),u.open(s,e.url,!0),u.withCredentials=a;for(var c in i)u.setRequestHeader(c,i[c]);u.send(o)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[4])(4)}),function(e){var t;"function"==typeof CustomEvent?t=new CustomEvent("growthpushReady",{}):(t=e.createEvent("Event"),t.initEvent("growthpushReady",!0,!0)),e.dispatchEvent(t)}(document);